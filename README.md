 # WeakBlacklist 插件

## 简介
WeakBlacklist 是一个 AstrBot 弱黑名单插件，可以对指定用户进行概率性回复，同时保持对话上下文的连贯性。与传统黑名单不同，弱黑名单用户的消息会被记录到对话历史中，只是不一定会收到回复。插件还支持保底回复机制，确保黑名单用户不会长时间得不到任何回应。

## 功能特点
- **概率性回复**：对黑名单用户按设定概率决定是否回复
- **保持上下文**：黑名单用户的消息依然会被大语言模型处理并记录到对话历史
- **保底回复机制**：当用户连续被拦截次数达到设定值时，触发强制回复
- **配置灵活**：可在 WebUI 中直接调整黑名单列表、回复概率和最大拦截次数
- **命令管理**：提供管理员命令查看黑名单状态

## 配置说明
在 AstrBot WebUI 的插件配置页面可以设置以下参数：

- **reply_probability**：对弱黑名单用户的回复概率 (0.0 到 1.0)
- **max_interception_count**：最大连续拦截次数，达到后会触发保底回复 (0 表示禁用保底机制)
- **log_blocked_messages**：是否在日志中记录被拦截的消息
- **blacklisted_users**：弱黑名单用户ID列表，可直接在WebUI中添加或删除

## 使用方法
### 管理员命令
- `/weakblacklist list` - 查看当前黑名单列表及每个用户的拦截计数状态

### 工作原理
1. 当黑名单用户发送消息时，插件会检查是否应该回复：
   - 如果用户已连续被拦截次数接近最大值，触发保底回复
   - 否则根据设定的概率决定是否回复
2. 如果决定不回复，用户消息仍会被处理但不会收到回复，同时拦截计数+1
3. 如果决定回复（概率通过或保底触发），拦截计数重置为0

## 注意事项
- 即使不回复，消息也会被发送到大语言模型处理，可能产生API费用
- 如果要完全屏蔽某用户，建议使用其他黑名单插件
- 将黑名单用户从列表中移除后，其拦截计数会自动清除
